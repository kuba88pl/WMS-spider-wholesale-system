<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>üï∑Ô∏è WMS Spiders Wholesale</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body class="bg-light">
<div class="container py-4">
    <h1 class="mb-4 text-center">üï∑Ô∏è System Hurtowy PajƒÖk√≥w</h1>

    <div class="card mb-4">
        <div class="card-header">‚ûï Dodaj klienta</div>
        <div class="card-body">
            <form id="addCustomerForm">
                <div class="row g-2">
                    <div class="col-md-6"><input type="text" class="form-control" placeholder="Imiƒô" id="firstName" required></div>
                    <div class="col-md-6"><input type="text" class="form-control" placeholder="Nazwisko" id="lastName" required></div>
                    <div class="col-12"><input type="email" class="form-control" placeholder="Email" id="email" required></div>
                </div>
                <button type="submit" class="btn btn-success mt-3">Dodaj klienta</button>
            </form>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header">‚ûï Dodaj pajƒÖka</div>
        <div class="card-body">
            <form id="addSpiderForm">
                <div class="row g-2">
                    <div class="col-md-6">
                        <input type="text" class="form-control" placeholder="Gatunek" id="speciesName" required>
                    </div>
                    <div class="col-md-6">
                        <input type="text" class="form-control" placeholder="Typ" id="typeName">
                    </div>
                    <div class="col-md-6">
                        <input type="number" class="form-control" placeholder="Cena" id="price" step="0.01" required>
                    </div>
                    <div class="col-md-6">
                        <input type="number" class="form-control" placeholder="Ilo≈õƒá" id="quantity" required>
                    </div>
                    <div class="col-md-6">
                        <input type="text" class="form-control" placeholder="Rozmiar" id="size" required>
                    </div>
                </div>
                <button type="submit" class="btn btn-success mt-3">Dodaj pajƒÖka</button>
            </form>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header">üì¶ Utw√≥rz zam√≥wienie</div>
        <div class="card-body">
            <form id="orderForm">
                <div class="mb-3">
                    <label for="customerSelect" class="form-label">Wybierz klienta</label>
                    <select class="form-select" id="customerSelect" required></select>
                </div>
                <div class="mb-3">
                    <label for="spiderSelect" class="form-label">Wybierz pajƒÖka</label>
                    <select class="form-select" id="spiderSelect" required></select>
                </div>
                <div class="mb-3">
                    <label for="spiderQuantity" class="form-label">Ilo≈õƒá</label>
                    <input type="number" class="form-control" id="spiderQuantity" min="1" required>
                </div>
                <button type="submit" class="btn btn-primary">Utw√≥rz zam√≥wienie</button>
            </form>
        </div>
    </div>

    <hr>

    <div class="row">
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">üìã Lista klient√≥w</div>
                <div class="card-body">
                    <table class="table table-striped" id="customersTable">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>Imiƒô</th>
                            <th>Nazwisko</th>
                            <th>Email</th>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">üìã Lista pajƒÖk√≥w</div>
                <div class="card-body">
                    <table class="table table-striped" id="spidersTable">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>Gatunek</th>
                            <th>Cena</th>
                            <th>Ilo≈õƒá</th>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <hr>

    <div class="card">
        <div class="card-header">üìã Lista zam√≥wie≈Ñ</div>
        <div class="card-body">
            <table class="table table-striped" id="ordersTable">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Klient</th>
                    <th>Data</th>
                    <th>Status</th>
                    <th>Cena</th>
                </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const API = {
        customers: '/api/customers',
        spiders: '/api/spiders',
        orders: '/api/orders'
    };

    // Funkcje do pobierania i wy≈õwietlania danych
    async function fetchAndPopulateCustomers() {
        try {
            const response = await axios.get(API.customers);
            const customers = response.data.content;
            const tableBody = document.querySelector('#customersTable tbody');
            const select = document.getElementById('customerSelect');

            tableBody.innerHTML = '';
            select.innerHTML = '<option value="">-- wybierz klienta --</option>';

            customers.forEach(customer => {
                tableBody.innerHTML += `
                        <tr>
                            <td>${customer.id}</td>
                            <td>${customer.firstName}</td>
                            <td>${customer.lastName}</td>
                            <td>${customer.email}</td>
                        </tr>
                    `;
                select.innerHTML += `<option value="${customer.id}">${customer.firstName} ${customer.lastName}</option>`;
            });
        } catch (error) {
            console.error('B≈ÇƒÖd podczas pobierania klient√≥w:', error);
        }
    }

    async function fetchAndPopulateSpiders() {
        try {
            const response = await axios.get(API.spiders);
            const spiders = response.data.content;
            const tableBody = document.querySelector('#spidersTable tbody');
            const select = document.getElementById('spiderSelect');

            tableBody.innerHTML = '';
            select.innerHTML = '<option value="">-- wybierz pajƒÖka --</option>';

            spiders.forEach(spider => {
                tableBody.innerHTML += `
                        <tr>
                            <td>${spider.id}</td>
                            <td>${spider.speciesName}</td>
                            <td>${spider.price.toFixed(2)} z≈Ç</td>
                            <td>${spider.quantity}</td>
                        </tr>
                    `;
                select.innerHTML += `<option value="${spider.id}">${spider.speciesName}</option>`;
            });
        } catch (error) {
            console.error('B≈ÇƒÖd podczas pobierania pajƒÖk√≥w:', error);
        }
    }

    async function fetchAndPopulateOrders() {
        try {
            const response = await axios.get(API.orders);
            const orders = response.data.content;
            const tableBody = document.querySelector('#ordersTable tbody');

            tableBody.innerHTML = '';

            orders.forEach(order => {
                tableBody.innerHTML += `
                        <tr>
                            <td>${order.id}</td>
                            <td>${order.customerId}</td>
                            <td>${order.date}</td>
                            <td>${order.status}</td>
                            <td>${order.price.toFixed(2)} z≈Ç</td>
                        </tr>
                    `;
            });
        } catch (error) {
            console.error('B≈ÇƒÖd podczas pobierania zam√≥wie≈Ñ:', error);
        }
    }

    // Obs≈Çuga formularzy
    document.getElementById('addCustomerForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const customer = {
            firstName: document.getElementById('firstName').value,
            lastName: document.getElementById('lastName').value,
            email: document.getElementById('email').value,
        };
        try {
            await axios.post(API.customers, customer);
            alert('Klient dodany pomy≈õlnie!');
            e.target.reset();
            fetchAndPopulateCustomers();
        } catch (error) {
            alert('B≈ÇƒÖd podczas dodawania klienta!');
            console.error('B≈ÇƒÖd:', error.response.data);
        }
    });

    document.getElementById('addSpiderForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const spider = {
            speciesName: document.getElementById('speciesName').value,
            typeName: document.getElementById('typeName').value,
            price: parseFloat(document.getElementById('price').value),
            quantity: parseInt(document.getElementById('quantity').value),
            size: document.getElementById('size').value,
            isCites: false
        };
        try {
            await axios.post(API.spiders, spider);
            alert('PajƒÖk dodany pomy≈õlnie!');
            e.target.reset();
            fetchAndPopulateSpiders();
        } catch (error) {
            alert('B≈ÇƒÖd podczas dodawania pajƒÖka!');
            console.error('B≈ÇƒÖd:', error.response.data);
        }
    });

    document.getElementById('orderForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const customerId = document.getElementById('customerSelect').value;
        const spiderId = document.getElementById('spiderSelect').value;
        const quantity = parseInt(document.getElementById('spiderQuantity').value);

        const orderData = {
            customerId: customerId,
            orderedSpiders: [{
                spiderId: spiderId,
                quantity: quantity
            }]
        };

        try {
            await axios.post(API.orders, orderData);
            alert('Zam√≥wienie utworzone pomy≈õlnie!');
            e.target.reset();
            fetchAndPopulateOrders();
            fetchAndPopulateSpiders(); // Od≈õwie≈º listƒô pajƒÖk√≥w, aby pokazaƒá zaktualizowanƒÖ ilo≈õƒá
        } catch (error) {
            alert('B≈ÇƒÖd podczas tworzenia zam√≥wienia!');
            console.error('B≈ÇƒÖd:', error.response.data);
        }
    });

    // Inicjalizacja danych po za≈Çadowaniu strony
    document.addEventListener('DOMContentLoaded', () => {
        fetchAndPopulateCustomers();
        fetchAndPopulateSpiders();
        fetchAndPopulateOrders();
    });
</script>
</body>
</html>