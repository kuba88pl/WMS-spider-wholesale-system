<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>🧑‍💼 Klienci</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800">

<div class="max-w-6xl mx-auto p-6">
    <h1 class="text-3xl font-bold text-center mb-6">🧑‍💼 Lista klientów</h1>

    <table class="w-full table-auto border border-gray-300 bg-white shadow-sm rounded-lg mb-8">
        <thead class="bg-gray-200">
        <tr>
            <th class="p-2 text-left">ID</th>
            <th class="p-2 text-left">Imię</th>
            <th class="p-2 text-left">Nazwisko</th>
            <th class="p-2 text-left">Email</th>
            <th class="p-2 text-left">Telefon</th>
            <th class="p-2 text-left">Adres</th>
            <th class="p-2 text-left">Paczkomat</th>
            <th class="p-2 text-left">Akcje</th>
        </tr>
        </thead>
        <tbody id="customerTableBody"></tbody>
    </table>

    <div class="bg-white p-6 rounded-lg shadow-md">
        <h2 id="formTitle" class="text-xl font-semibold mb-4">➕ Dodaj klienta</h2>
        <form id="customerForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <input type="text" name="firstName" class="border p-2 rounded" placeholder="Imię" required>
            <input type="text" name="lastName" class="border p-2 rounded" placeholder="Nazwisko" required>
            <input type="email" name="email" class="border p-2 rounded" placeholder="Email" required>
            <input type="text" name="telephone" class="border p-2 rounded" placeholder="Telefon" required>
            <input type="text" name="address" class="border p-2 rounded" placeholder="Adres wysyłki" required>
            <input type="text" name="parcelLocker" class="border p-2 rounded" placeholder="Numer paczkomatu">
            <div class="flex gap-2 mt-2 md:col-span-2">
                <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">💾 Zapisz</button>
                <button type="button" onclick="cancelEdit()" class="bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500">❌ Anuluj</button>
            </div>
        </form>
    </div>
</div>

<script>
    const API = "http://localhost:8080/api/customers";
    let editingId = null;

    function loadCustomers() {
        fetch(API)
            .then(res => res.json())
            .then(data => {
                const tbody = document.getElementById("customerTableBody");
                tbody.innerHTML = "";
                data.content.forEach(customer => {
                    const tr = document.createElement("tr");
                    tr.className = "border-t";
                    tr.innerHTML = `
                        <td class="p-2">${customer.id}</td>
                        <td class="p-2">${customer.firstName}</td>
                        <td class="p-2">${customer.lastName}</td>
                        <td class="p-2">${customer.email}</td>
                        <td class="p-2">${customer.telephone}</td>
                        <td class="p-2">${customer.address || ""}</td>
                        <td class="p-2">${customer.parcelLocker || ""}</td>
                        <td class="p-2 flex gap-2">
                            <button onclick="editCustomer('${customer.id}')" class="bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600">✏️ Edytuj</button>
                            <button onclick="deleteCustomer('${customer.id}')" class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600">🗑 Usuń</button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            });
    }

    function deleteCustomer(id) {
        fetch(`${API}/${id}`, { method: "DELETE" })
            .then(() => loadCustomers());
    }

    function editCustomer(id) {
        fetch(`${API}/${id}`)
            .then(res => res.json())
            .then(customer => {
                const form = document.getElementById("customerForm");
                form.firstName.value = customer.firstName;
                form.lastName.value = customer.lastName;
                form.email.value = customer.email;
                form.telephone.value = customer.telephone;
                form.address.value = customer.address || "";
                form.parcelLocker.value = customer.parcelLocker || "";
                editingId = customer.id;
                document.getElementById("formTitle").textContent = "✏️ Edytuj klienta";
            });
    }

    function cancelEdit() {
        document.getElementById("customerForm").reset();
        editingId = null;
        document.getElementById("formTitle").textContent = "➕ Dodaj klienta";
    }

    document.getElementById("customerForm").addEventListener("submit", e => {
        e.preventDefault();
        const form = e.target;
        const customer = {
            id: editingId,
            firstName: form.firstName.value,
            lastName: form.lastName.value,
            email: form.email.value,
            telephone: form.telephone.value,
            address: form.address.value,
            parcelLocker: form.parcelLocker.value
        };
        const method = editingId ? "PUT" : "POST";
        fetch(API, {
            method: method,
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(customer)
        })
            .then(() => {
                form.reset();
                cancelEdit();
                loadCustomers();
            });
    });

    loadCustomers();
</script>

</body>
</html>
